<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Docs of PHP-little-utils: /home/peter/gits/php-little-utils/src/strings.php</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Docs of PHP-little-utils
   &#160;<span id="projectnumber">v1.0.1</span>
   </div>
   <div id="projectbrief">.... blabla synopsis of PHP-little-utils...</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">/home/peter/gits/php-little-utils/src/strings.php</div>  </div>
</div><!--header-->
<div class="contents">
<p>String functions.</p><dl class="section see"><dt>See also</dt><dd><a href="https://github.com/ppKrauss/php-little-utils">https://github.com/ppKrauss/php-little-utils</a>  <a class="el" href="../../d0/d0b/a00004.html#a9b9b364c1e744c2c2c9fc89a7cc355b8" title="Basic checks functions. ">isFile()</a> at basiChecks.php Get the commom start-string of two or more strings. The algorithm splits the string by its differences. </dd></dl>
<dl class="section version"><dt>Version</dt><dd>1.1 of 2015-06-04  MIT License Copyright (c) 2016 Peter Krauss </dd></dl>
<dl class="section see"><dt>See also</dt><dd>this function can feed the root for <a class="el" href="../../de/d21/a00006.html#ab9c46f395737d2c867fe87d6260a68a7" title="Splits a string by its root and sufix. ">str_splitByRoot()</a> function.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$a</td><td>mix, string for final operation, or array iteration. </td></tr>
    <tr><td class="paramname">$b</td><td>string with probable commom root, or integer for array index. </td></tr>
    <tr><td class="paramname">$minLen</td><td>integer minimal length. </td></tr>
    <tr><td class="paramname">$retFamily</td><td>boolean true for return family. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string $root.</dd></dl>
<p>$root=str_getRoot($DOIs,1,5); foreach ($DOIs as $doi) { $dif = str_splitByRoot($doi, $root, ' * '); print "\n-- $doi \t= $dif"; }</p>
<div class="fragment"><div class="line">&lt;?php</div><div class="line"> <span class="comment">// // // // // // // // // // // // //</span></div><div class="line"> <span class="comment">// BEGIN:getRoot</span></div><div class="line"> <span class="comment">//</span></div><div class="line"></div><div class="line"><span class="keyword">function</span> <a name="a0"></a><a class="code" href="../../de/d21/a00006.html#ae62517bac06af710f9f05bb167f151e5">str_getRoot</a>($a,$b=<span class="stringliteral">&#39;&#39;</span>,$minLen=1,$retFamily=<span class="keyword">false</span>) {</div><div class="line">    <span class="keywordflow">if</span> (is_array($a)) { <span class="comment">// $b is a seed.</span></div><div class="line">        <span class="keywordflow">if</span> (is_integer($b))</div><div class="line">            $b = $a[$b];</div><div class="line">        <span class="keywordflow">if</span> (!$b &amp;&amp; isset($a[0])) $b=$a[0];</div><div class="line">        $family = array();</div><div class="line">        <span class="keywordflow">foreach</span> ($a as $item) {</div><div class="line">            <span class="keywordflow">if</span> (is_array($item)) die(<span class="stringliteral">&quot;array of array is invalid&quot;</span>);</div><div class="line">            $r = <a class="code" href="../../de/d21/a00006.html#ae62517bac06af710f9f05bb167f151e5">str_getRoot</a>($item,$b);</div><div class="line">            <span class="keywordflow">if</span> (strlen($r)&gt;=$minLen) {</div><div class="line">                <span class="keywordflow">if</span> ($retFamily) $family[]=$item;</div><div class="line">                <span class="keywordflow">if</span> ($r!=$b) $b=$r;</div><div class="line">            } <span class="comment">//if</span></div><div class="line">        } <span class="comment">// for</span></div><div class="line">        <span class="keywordflow">if</span> ($retFamily) {</div><div class="line">            array_unshift($family,$b);</div><div class="line">            <span class="keywordflow">return</span> $family;</div><div class="line">        } <span class="keywordflow">else</span></div><div class="line">            <span class="keywordflow">return</span> $b;</div><div class="line">    } <span class="keywordflow">else</span> {  <span class="comment">// $b is a root</span></div><div class="line">        $rooLen = strspn($b ^ $a, <span class="stringliteral">&quot;\0&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> substr($a,0,$rooLen);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">function</span>  <a name="a1"></a><a class="code" href="../../de/d21/a00006.html#ab9c46f395737d2c867fe87d6260a68a7">str_splitByRoot</a>($str, $root, $retSep=<span class="stringliteral">&#39;&#39;</span>) {</div><div class="line">    $r = ($root &amp;&amp; strpos($str,$root)===0) ?</div><div class="line">        array($root, substr($str, strlen($root)) ) :</div><div class="line">        array( <span class="stringliteral">&#39;&#39;</span>, $str )</div><div class="line">    ;</div><div class="line">    <span class="keywordflow">return</span> $retSep? <span class="stringliteral">&quot;$r[0]$retSep$r[1]&quot;</span>: $r;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// END:getRoot</span></div><div class="line"><span class="comment">// // // // // // // // // // // // //</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">function</span> <a name="a2"></a><a class="code" href="../../de/d21/a00006.html#a8eb3dba72cad59d68a27c5667e47207e">format_nomePtBR</a>($val) { <span class="keywordflow">return</span> <a name="a3"></a><a class="code" href="../../de/d21/a00006.html#a117e64aa45bf108e9e93450c72f8e5d1">format_name_PtBR</a>($val);} <span class="comment">// old function</span></div><div class="line"><span class="keyword">function</span> <a class="code" href="../../de/d21/a00006.html#a117e64aa45bf108e9e93450c72f8e5d1">format_name_PtBR</a>($val) {</div><div class="line">  <span class="comment">// $curloc = setlocale(LC_ALL, 0);</span></div><div class="line">  <span class="comment">// nem assim! if (substr($curloc,0,20)!=&#39;LC_CTYPE=pt_BR.UTF-8&#39;) die(&quot;\nERRO323: Brazil requer LC_CTYPE=pt_BR.UTF-8!!&quot;);</span></div><div class="line">  $minuscular = [</div><div class="line">    <span class="stringliteral">&#39;de&#39;</span>, <span class="stringliteral">&#39;di&#39;</span>, <span class="stringliteral">&#39;do&#39;</span>, <span class="stringliteral">&#39;da&#39;</span>, <span class="stringliteral">&#39;dos&#39;</span>, <span class="stringliteral">&#39;das&#39;</span>, <span class="stringliteral">&#39;dello&#39;</span>, <span class="stringliteral">&#39;della&#39;</span>, <span class="stringliteral">&#39;dalla&#39;</span>,</div><div class="line">    <span class="stringliteral">&#39;dal&#39;</span>, <span class="stringliteral">&#39;del&#39;</span>, <span class="charliteral">&#39;e&#39;</span>, <span class="stringliteral">&#39;em&#39;</span>, <span class="stringliteral">&#39;na&#39;</span>, <span class="stringliteral">&#39;no&#39;</span>, <span class="stringliteral">&#39;nas&#39;</span>, <span class="stringliteral">&#39;nos&#39;</span>, <span class="stringliteral">&#39;van&#39;</span>, <span class="stringliteral">&#39;von&#39;</span>, <span class="charliteral">&#39;y&#39;</span></div><div class="line">  ];</div><div class="line">  $parts = preg_split( <span class="stringliteral">&#39;/\s+/&#39;</span>, mb_strtolower(trim($val),<span class="stringliteral">&#39;UTF-8&#39;</span>) );</div><div class="line">  $s=[];</div><div class="line">  <span class="keywordflow">foreach</span>($parts as $w)</div><div class="line">    $s[] = in_array($w,$minuscular)? $w: mb_convert_case($w,MB_CASE_TITLE,<span class="stringliteral">&#39;UTF-8&#39;</span>);</div><div class="line">  <span class="keywordflow">return</span> join(<span class="charliteral">&#39; &#39;</span>,$s);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// // // // // // // // // // // // //</span></div><div class="line"><span class="comment">// BEGIN:auto-linking</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line">    <span class="comment">/* A PHP auto-linking library</span></div><div class="line"><span class="comment">    * https://github.com/iamcal/lib_autolink</span></div><div class="line"><span class="comment">    * This code is licensed under the MIT license</span></div><div class="line"><span class="comment">  *</span></div><div class="line"><span class="comment">    * These are global options. You can set them before calling the autolinking</span></div><div class="line"><span class="comment">    * functions to change the output.</span></div><div class="line"><span class="comment">    $GLOBALS[&#39;autolink_options&#39;] = array(&#39;strip_protocols&#39; =&gt; true,);</span></div><div class="line"><span class="comment">        # Should http:// be visibly stripped from the front of URLs?</span></div><div class="line"><span class="comment">    */</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">function</span> <a name="a4"></a><a class="code" href="../../de/d21/a00006.html#af3b7f7546471fbf1ad3ae709d20988a8">autolink</a>($text, $limit=30, $tagfill=<span class="stringliteral">&#39;&#39;</span>, $auto_title = <span class="keyword">true</span>){</div><div class="line"></div><div class="line">        $text = <a name="a5"></a><a class="code" href="../../de/d21/a00006.html#a82ba0a0100959a7f7ef75ace86753bad">autolink_do</a>($text, <span class="stringliteral">&#39;![a-z][a-z-]+://!i&#39;</span>,    $limit, $tagfill, $auto_title);</div><div class="line">        $text = <a class="code" href="../../de/d21/a00006.html#a82ba0a0100959a7f7ef75ace86753bad">autolink_do</a>($text, <span class="stringliteral">&#39;!(mailto|skype):!i&#39;</span>,    $limit, $tagfill, $auto_title);</div><div class="line">        $text = <a class="code" href="../../de/d21/a00006.html#a82ba0a0100959a7f7ef75ace86753bad">autolink_do</a>($text, <span class="stringliteral">&#39;!www\\.!i&#39;</span>,         $limit, $tagfill, $auto_title, <span class="stringliteral">&#39;http://&#39;</span>);</div><div class="line">        <span class="keywordflow">return</span> $text;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">function</span> <a class="code" href="../../de/d21/a00006.html#a82ba0a0100959a7f7ef75ace86753bad">autolink_do</a>($text, $sub, $limit, $tagfill, $auto_title, $force_prefix=null){</div><div class="line"></div><div class="line">        $text_l = StrToLower($text);</div><div class="line">        $cursor = 0;</div><div class="line">        $loop = 1;</div><div class="line">        $buffer = <span class="stringliteral">&#39;&#39;</span>;</div><div class="line"></div><div class="line">        <span class="keywordflow">while</span> (($cursor &lt; strlen($text)) &amp;&amp; $loop){</div><div class="line"></div><div class="line">            $ok = 1;</div><div class="line">            $matched = preg_match($sub, $text_l, $m, PREG_OFFSET_CAPTURE, $cursor);</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (!$matched){</div><div class="line"></div><div class="line">                $loop = 0;</div><div class="line">                $ok = 0;</div><div class="line"></div><div class="line">            }<span class="keywordflow">else</span>{</div><div class="line"></div><div class="line">                $pos = $m[0][1];</div><div class="line">                $sub_len = strlen($m[0][0]);</div><div class="line"></div><div class="line">                $pre_hit = substr($text, $cursor, $pos-$cursor);</div><div class="line">                $hit = substr($text, $pos, $sub_len);</div><div class="line">                $pre = substr($text, 0, $pos);</div><div class="line">                $post = substr($text, $pos + $sub_len);</div><div class="line"></div><div class="line">                $fail_text = $pre_hit.$hit;</div><div class="line">                $fail_len = strlen($fail_text);</div><div class="line"></div><div class="line"><span class="preprocessor">                #</span></div><div class="line"><span class="preprocessor">                # substring found - first check to see if we&#39;re inside a link tag already...</span></div><div class="line"><span class="preprocessor">                #</span></div><div class="line">                $bits = preg_split(<span class="stringliteral">&quot;!&lt;/a&gt;!i&quot;</span>, $pre);</div><div class="line">                $last_bit = array_pop($bits);</div><div class="line">                <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&quot;!&lt;a\s!i&quot;</span>, $last_bit)){</div><div class="line"></div><div class="line"><span class="preprocessor">                    #echo &quot;fail 1 at $cursor&lt;br /&gt;\n&quot;;</span></div><div class="line"></div><div class="line">                    $ok = 0;</div><div class="line">                    $cursor += $fail_len;</div><div class="line">                    $buffer .= $fail_text;</div><div class="line">                }</div><div class="line">            }</div><div class="line"></div><div class="line"><span class="preprocessor">            #</span></div><div class="line"><span class="preprocessor">            # looks like a nice spot to autolink from - check the pre</span></div><div class="line"><span class="preprocessor">            # to see if there was whitespace before this match</span></div><div class="line"><span class="preprocessor">            #</span></div><div class="line">            <span class="keywordflow">if</span> ($ok){</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> ($pre){</div><div class="line">                    <span class="keywordflow">if</span> (!preg_match(<span class="stringliteral">&#39;![\s\(\[\{&gt;]$!s&#39;</span>, $pre)){</div><div class="line"></div><div class="line"><span class="preprocessor">                        #echo &quot;fail 2 at $cursor ($pre)&lt;br /&gt;\n&quot;;</span></div><div class="line"></div><div class="line">                        $ok = 0;</div><div class="line">                        $cursor += $fail_len;</div><div class="line">                        $buffer .= $fail_text;</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line"></div><div class="line"><span class="preprocessor">            #</span></div><div class="line"><span class="preprocessor">            # we want to autolink here - find the extent of the url</span></div><div class="line"><span class="preprocessor">            #</span></div><div class="line">            <span class="keywordflow">if</span> ($ok){</div><div class="line">                <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^([a-z0-9\-\.\/\-_%~!?=,:;&amp;+*#@\(\)\$]+)/i&#39;</span>, $post, $matches)){</div><div class="line"></div><div class="line">                    $url = $hit.$matches[1];</div><div class="line"></div><div class="line">                    $cursor += strlen($url) + strlen($pre_hit);</div><div class="line">                    $buffer .= $pre_hit;</div><div class="line"></div><div class="line">                    $url = html_entity_decode($url);</div><div class="line"></div><div class="line"><span class="preprocessor">                    #</span></div><div class="line"><span class="preprocessor">                    # remove trailing punctuation from url</span></div><div class="line"><span class="preprocessor">                    #</span></div><div class="line">                    <span class="keywordflow">while</span> (preg_match(<span class="stringliteral">&#39;|[.,!;:?]$|&#39;</span>, $url)){</div><div class="line">                        $url = substr($url, 0, strlen($url)-1);</div><div class="line">                        $cursor--;</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">foreach</span> (array(<span class="stringliteral">&#39;()&#39;</span>, <span class="stringliteral">&#39;[]&#39;</span>, <span class="stringliteral">&#39;{}&#39;</span>) as $pair){</div><div class="line">                        $o = substr($pair, 0, 1);</div><div class="line">                        $c = substr($pair, 1, 1);</div><div class="line">                        <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&quot;!^(\\$c|^)[^\\$o]+\\$c$!&quot;</span>, $url)){</div><div class="line">                            $url = substr($url, 0, strlen($url)-1);</div><div class="line">                            $cursor--;</div><div class="line">                        }</div><div class="line">                    }</div><div class="line"></div><div class="line"><span class="preprocessor">                    #</span></div><div class="line"><span class="preprocessor">                    # nice-i-fy url here</span></div><div class="line"><span class="preprocessor">                    #</span></div><div class="line">                    $link_url = $url;</div><div class="line">                    $display_url = $url;</div><div class="line"></div><div class="line">                    <span class="keywordflow">if</span> ($force_prefix) $link_url = $force_prefix.$link_url;</div><div class="line"></div><div class="line">                    <span class="keywordflow">if</span> ($GLOBALS[<span class="stringliteral">&#39;autolink_options&#39;</span>][<span class="stringliteral">&#39;strip_protocols&#39;</span>]){</div><div class="line">                        <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;!^(http|https)://!i&#39;</span>, $display_url, $m)){</div><div class="line"></div><div class="line">                            $display_url = substr($display_url, strlen($m[1])+3);</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                    $display_url = <a name="a6"></a><a class="code" href="../../de/d21/a00006.html#ae602e0032a308724c066db1168941d31">autolink_label</a>($display_url, $limit);</div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">                    #</span></div><div class="line"><span class="preprocessor">                    # add the url</span></div><div class="line"><span class="preprocessor">                    #</span></div><div class="line"></div><div class="line">                    $currentTagfill = $tagfill;</div><div class="line">                    <span class="keywordflow">if</span> ($display_url != $link_url &amp;&amp; !preg_match(<span class="stringliteral">&#39;@title=@msi&#39;</span>,$currentTagfill) &amp;&amp; $auto_title) {</div><div class="line"></div><div class="line">                        $display_quoted = preg_quote($display_url, <span class="charliteral">&#39;!&#39;</span>);</div><div class="line"></div><div class="line">                        <span class="keywordflow">if</span> (!preg_match(<span class="stringliteral">&quot;!^(http|https)://{$display_quoted}$!i&quot;</span>, $link_url)){</div><div class="line"></div><div class="line">                            $currentTagfill .= <span class="stringliteral">&#39; title=&quot;&#39;</span>.$link_url.<span class="charliteral">&#39;&quot;&#39;</span>;</div><div class="line">                        }</div><div class="line">                    }</div><div class="line"></div><div class="line">                    $link_url_enc = HtmlSpecialChars($link_url);</div><div class="line">                    $display_url_enc = HtmlSpecialChars($display_url);</div><div class="line"></div><div class="line">                    $buffer .= <span class="stringliteral">&quot;&lt;a href=\&quot;{$link_url_enc}\&quot;$currentTagfill&gt;{$display_url_enc}&lt;/a&gt;&quot;</span>;</div><div class="line"></div><div class="line">                }<span class="keywordflow">else</span>{</div><div class="line"><span class="preprocessor">                    #echo &quot;fail 3 at $cursor&lt;br /&gt;\n&quot;;</span></div><div class="line"></div><div class="line">                    $ok = 0;</div><div class="line">                    $cursor += $fail_len;</div><div class="line">                    $buffer .= $fail_text;</div><div class="line">                }</div><div class="line">            }</div><div class="line"></div><div class="line">        }</div><div class="line"></div><div class="line"><span class="preprocessor">        #</span></div><div class="line"><span class="preprocessor">        # add everything from the cursor to the end onto the buffer.</span></div><div class="line"><span class="preprocessor">        #</span></div><div class="line">        $buffer .= substr($text, $cursor);</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span> $buffer;</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">function</span> <a class="code" href="../../de/d21/a00006.html#ae602e0032a308724c066db1168941d31">autolink_label</a>($text, $limit){</div><div class="line">        <span class="keywordflow">if</span> (!$limit)</div><div class="line">            <span class="keywordflow">return</span> $text;</div><div class="line">        elseif (strlen($text) &gt; $limit)</div><div class="line">            <span class="keywordflow">return</span> substr($text, 0, $limit-3).<span class="stringliteral">&#39;...&#39;</span>;</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">            <span class="keywordflow">return</span> $text;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">function</span> <a name="a7"></a><a class="code" href="../../de/d21/a00006.html#a6739dd9330c62e11e11e02e0519cca7b">autolink_email</a>($text, $tagfill=<span class="stringliteral">&#39;&#39;</span>){</div><div class="line"></div><div class="line">        $atom = <span class="stringliteral">&#39;[^()&lt;&gt;@,;:\\\\&quot;.\\[\\]\\x00-\\x20\\x7f]+&#39;</span>; # from RFC822</div><div class="line"></div><div class="line"><span class="preprocessor">        #die($atom);</span></div><div class="line"></div><div class="line">        $text_l = StrToLower($text);</div><div class="line">        $cursor = 0;</div><div class="line">        $loop = 1;</div><div class="line">        $buffer = <span class="stringliteral">&#39;&#39;</span>;</div><div class="line"></div><div class="line">        <span class="keywordflow">while</span>(($cursor &lt; strlen($text)) &amp;&amp; $loop){</div><div class="line"></div><div class="line"><span class="preprocessor">            #</span></div><div class="line"><span class="preprocessor">            # find an &#39;@&#39; symbol</span></div><div class="line"><span class="preprocessor">            #</span></div><div class="line">            $ok = 1;</div><div class="line">            $pos = strpos($text_l, <span class="charliteral">&#39;@&#39;</span>, $cursor);</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> ($pos === <span class="keyword">false</span>){</div><div class="line"></div><div class="line">                $loop = 0;</div><div class="line">                $ok = 0;</div><div class="line"></div><div class="line">            }<span class="keywordflow">else</span>{</div><div class="line"></div><div class="line">                $pre = substr($text, $cursor, $pos-$cursor);</div><div class="line">                $hit = substr($text, $pos, 1);</div><div class="line">                $post = substr($text, $pos + 1);</div><div class="line"></div><div class="line">                $fail_text = $pre.$hit;</div><div class="line">                $fail_len = strlen($fail_text);</div><div class="line"></div><div class="line"><span class="preprocessor">                #die(&quot;$pre::$hit::$post::$fail_text&quot;);</span></div><div class="line"></div><div class="line"><span class="preprocessor">                #</span></div><div class="line"><span class="preprocessor">                # substring found - first check to see if we&#39;re inside a link tag already...</span></div><div class="line"><span class="preprocessor">                #</span></div><div class="line">                $bits = preg_split(<span class="stringliteral">&quot;!&lt;/a&gt;!i&quot;</span>, $pre);</div><div class="line">                $last_bit = array_pop($bits);</div><div class="line">                <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&quot;!&lt;a\s!i&quot;</span>, $last_bit)){</div><div class="line"></div><div class="line"><span class="preprocessor">                    #echo &quot;fail 1 at $cursor&lt;br /&gt;\n&quot;;</span></div><div class="line"></div><div class="line">                    $ok = 0;</div><div class="line">                    $cursor += $fail_len;</div><div class="line">                    $buffer .= $fail_text;</div><div class="line">                }</div><div class="line">            }</div><div class="line"></div><div class="line"><span class="preprocessor">            #</span></div><div class="line"><span class="preprocessor">            # check backwards</span></div><div class="line"><span class="preprocessor">            #</span></div><div class="line">            <span class="keywordflow">if</span> ($ok){</div><div class="line">                <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&quot;!($atom(\.$atom)*)\$!&quot;</span>, $pre, $matches)){</div><div class="line"></div><div class="line"><span class="preprocessor">                    # move matched part of address into $hit</span></div><div class="line"></div><div class="line">                    $len = strlen($matches[1]);</div><div class="line">                    $plen = strlen($pre);</div><div class="line"></div><div class="line">                    $hit = substr($pre, $plen-$len).$hit;</div><div class="line">                    $pre = substr($pre, 0, $plen-$len);</div><div class="line"></div><div class="line">                }<span class="keywordflow">else</span>{</div><div class="line"></div><div class="line"><span class="preprocessor">                    #echo &quot;fail 2 at $cursor ($pre)&lt;br /&gt;\n&quot;;</span></div><div class="line"></div><div class="line">                    $ok = 0;</div><div class="line">                    $cursor += $fail_len;</div><div class="line">                    $buffer .= $fail_text;</div><div class="line">                }</div><div class="line">            }</div><div class="line"></div><div class="line"><span class="preprocessor">            #</span></div><div class="line"><span class="preprocessor">            # check forwards</span></div><div class="line"><span class="preprocessor">            #</span></div><div class="line">            <span class="keywordflow">if</span> ($ok){</div><div class="line">                <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&quot;!^($atom(\.$atom)*)!&quot;</span>, $post, $matches)){</div><div class="line"></div><div class="line"><span class="preprocessor">                    # move matched part of address into $hit</span></div><div class="line"></div><div class="line">                    $len = strlen($matches[1]);</div><div class="line"></div><div class="line">                    $hit .= substr($post, 0, $len);</div><div class="line">                    $post = substr($post, $len);</div><div class="line"></div><div class="line">                }<span class="keywordflow">else</span>{</div><div class="line"><span class="preprocessor">                    #echo &quot;fail 3 at $cursor ($post)&lt;br /&gt;\n&quot;;</span></div><div class="line"></div><div class="line">                    $ok = 0;</div><div class="line">                    $cursor += $fail_len;</div><div class="line">                    $buffer .= $fail_text;</div><div class="line">                }</div><div class="line">            }</div><div class="line"></div><div class="line"><span class="preprocessor">            #</span></div><div class="line"><span class="preprocessor">            # commit</span></div><div class="line"><span class="preprocessor">            #</span></div><div class="line">            <span class="keywordflow">if</span> ($ok) {</div><div class="line"></div><div class="line">                $cursor += strlen($pre) + strlen($hit);</div><div class="line">                $buffer .= $pre;</div><div class="line">                $buffer .= <span class="stringliteral">&quot;&lt;a href=\&quot;mailto:$hit\&quot;$tagfill&gt;$hit&lt;/a&gt;&quot;</span>;</div><div class="line"></div><div class="line">            }</div><div class="line"></div><div class="line">        }</div><div class="line"></div><div class="line"><span class="preprocessor">        #</span></div><div class="line"><span class="preprocessor">        # add everything from the cursor to the end onto the buffer.</span></div><div class="line"><span class="preprocessor">        #</span></div><div class="line">        $buffer .= substr($text, $cursor);</div><div class="line">        <span class="keywordflow">return</span> $buffer;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// END:auto-linking</span></div><div class="line"><span class="comment">// // // // // // // // // // // // //</span></div><div class="line"></div><div class="line">?&gt;</div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
